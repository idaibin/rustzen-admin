---
description: 
globs: backend/*
alwaysApply: false
---
ğŸ§± rustzen-admin åç«¯å¼€å‘è§„èŒƒï¼ˆBackend Development Rulesï¼‰

æœ¬è§„èŒƒé€‚ç”¨äº rustzen-admin é¡¹ç›®çš„åç«¯æ¨¡å—ï¼Œä½¿ç”¨ Rust + Axum + SQLx æ„å»ºï¼Œæ—¨åœ¨æå‡ä»£ç ä¸€è‡´æ€§ã€å¯ç»´æŠ¤æ€§ã€å¯æµ‹è¯•æ€§ä¸åä½œæ•ˆç‡ï¼Œé€‚é… AI ç¼–ç¨‹å·¥å…·å¦‚ Cursor ç­‰è¾…åŠ©å¼€å‘å·¥å…·ã€‚
æ‰§è¡Œä»»ä½•å‘½ä»¤çš„æ—¶å€™ï¼Œè¯·å…ˆç¡®ä¿åœ¨ backend æ–‡ä»¶å¤¹ä¸­ï¼Œå¦‚æœä¸åœ¨ï¼Œè¯·ä½¿ç”¨ `cd backend`ã€‚

â¸»

ğŸ“¦ 1. é¡¹ç›®ç»“æ„çº¦å®šï¼ˆæ¨¡å—åŒ–åˆ†å±‚ï¼‰

src/
â”œâ”€â”€ main.rs // å¯åŠ¨å…¥å£
â”œâ”€â”€ app.rs // Axum App æ„å»ºé€»è¾‘
â”œâ”€â”€ core/ // æ ¸å¿ƒåŠŸèƒ½æ¨¡å—ï¼ˆä¸­é—´ä»¶ã€é…ç½®ã€æ—¥å¿—ç­‰ï¼‰
â”‚ â”œâ”€â”€ config.rs
â”‚ â”œâ”€â”€ db.rs
â”‚ â”œâ”€â”€ errors.rs
â”‚ â””â”€â”€ middleware/
â”œâ”€â”€ features/ // ä¸šåŠ¡æ¨¡å—ï¼ˆæŒ‰åŠŸèƒ½æ‹†åˆ†ï¼‰
â”‚ â”œâ”€â”€ user/
â”‚ â”‚ â”œâ”€â”€ model.rs
â”‚ â”‚ â”œâ”€â”€ repo.rs
â”‚ â”‚ â”œâ”€â”€ service.rs
â”‚ â”‚ â”œâ”€â”€ routes.rs
â”‚ â”‚ â””â”€â”€ mod.rs
â”‚ â””â”€â”€ ...

â¸»

ğŸ§© 2. æ¨¡å—èŒè´£è¯´æ˜

æ¯ä¸ªä¸šåŠ¡æ¨¡å—ï¼ˆå¦‚ userï¼‰ç”±ä»¥ä¸‹æ–‡ä»¶ç»„æˆï¼š

æ–‡ä»¶ ä½œç”¨æè¿°
model.rs å®šä¹‰æ•°æ®åº“ç»“æ„ã€è¯·æ±‚ä½“ã€å“åº”ä½“æ¨¡å‹ç»“æ„ï¼ˆå« camelCase æ˜ å°„ï¼‰
repo.rs è´Ÿè´£æ•°æ®åº“æ“ä½œï¼ˆSQL æŸ¥è¯¢ã€æ’å…¥ã€åˆ é™¤ç­‰ï¼‰
service.rs è´Ÿè´£ç»„åˆä¸šåŠ¡é€»è¾‘ï¼Œå¦‚æ ¡éªŒã€ç»„åˆ repoã€è§„åˆ™åˆ¤æ–­ç­‰
routes.rs å®šä¹‰ API è·¯ç”±å’Œ handlerï¼Œè°ƒç”¨ service æ–¹æ³•
mod.rs æ¨¡å—ç»Ÿä¸€å¯¼å‡ºæ¥å£

â¸»

ğŸ¯ 3. å‘½åä¸é£æ ¼

æ¨¡å‹å‘½åè§„èŒƒ
â€¢ Rust å†…éƒ¨ä½¿ç”¨ snake_case
â€¢ å¯¹å¤– API è¿”å›ä½¿ç”¨ camelCaseï¼Œé€šè¿‡ #[serde(rename_all = "camelCase")] å®ç°

#[derive(Serialize, Deserialize)] #[serde(rename_all = "camelCase")]
pub struct UserResponse {
pub user_name: String,
pub email: String,
}

å‘½åè§„åˆ™

ç±»å‹ å‘½åé£æ ¼ ç¤ºä¾‹
æ–‡ä»¶å snake_case user.rs, user_model.rs
Struct PascalCase UserResponse
å‡½æ•° snake_case get_user_list()
è¡¨å snake_case sys_user, sys_role

â¸»

ğŸ›  4. æ•°æ®è®¿é—®ä¸ Repository æ¨¡å¼
â€¢ æ‰€æœ‰ SQL æŸ¥è¯¢å°è£…åœ¨ repo.rs ä¸­
â€¢ æ¨èä½¿ç”¨ sqlx::query_as! ä¿è¯ç±»å‹å®‰å…¨
â€¢ å‡½æ•°å…¥å‚ä¸º &PgPool, å‡ºå‚ä¸º Result<T, AppError>

pub async fn find_by_username(pool: &PgPool, username: &str) -> Result<Option<UserModel>, AppError> {
sqlx::query_as!(UserModel, "SELECT \* FROM sys_user WHERE username = $1", username)
.fetch_optional(pool)
.await
.map_err(AppError::from)
}

â¸»

ğŸ”„ 5. API å“åº”ç»“æ„

æ‰€æœ‰æ¥å£ç»Ÿä¸€ä½¿ç”¨ä»¥ä¸‹ JSON æ ¼å¼è¿”å›ï¼š

{
"code": 0,
"message": "success",
"data": { ... }
}

    â€¢	ä½¿ç”¨ç±»å‹åˆ«åå°è£…è¿”å›å€¼ï¼štype ApiResult<T> = Result<ApiResponse<T>, AppError>
    â€¢	æ¨èæä¾›å¿«æ·å‡½æ•° success()

â¸»

ğŸ” 6. é‰´æƒä¸ä¸­é—´ä»¶

ç»Ÿä¸€æ”¾ç½®åœ¨ core/middleware/ï¼š
â€¢ auth.rsï¼šJWT è§£ç ï¼Œæ³¨å…¥ç”¨æˆ·ä¿¡æ¯
â€¢ rbac.rsï¼šæƒé™åˆ¤æ–­ä¸­é—´ä»¶
â€¢ tracing.rsï¼šæ—¥å¿—ä¸­é—´ä»¶

ä½¿ç”¨ Extension<UserClaims> æ³¨å…¥å½“å‰ç”¨æˆ·èº«ä»½ä¿¡æ¯

â¸»

ğŸ“‹ 7. é…ç½®ä¸ç¯å¢ƒå˜é‡

ä½¿ç”¨ dotenvy + std::env ç®¡ç† .env é…ç½®
â€¢ æ‰€æœ‰é…ç½®é›†ä¸­åœ¨ core/config.rs
â€¢ æ”¯æŒ dev, prod, test ç¯å¢ƒå˜é‡åˆ‡æ¢

DATABASE_URL=postgres://...
JWT_SECRET=xxx
SERVER_PORT=8080

â¸»

ğŸ§ª 8. æµ‹è¯•è§„èŒƒ
â€¢ æ‰€æœ‰æµ‹è¯•æ”¾åœ¨æ¨¡å—å†… mod tests {} æˆ– mod_test.rs
â€¢ ä½¿ç”¨ #[tokio::test] å¼‚æ­¥æµ‹è¯•
â€¢ å•å…ƒæµ‹è¯• mock æ•°æ®ï¼Œé›†æˆæµ‹è¯•ä½¿ç”¨æµ‹è¯•æ•°æ®åº“

â¸»

âœ… 9. ä»£ç è´¨é‡å»ºè®®
â€¢ å¯ç”¨ clippy + rustfmt
â€¢ æ‰€æœ‰ä¸šåŠ¡å‡½æ•°è¿”å› Result<T, AppError>
â€¢ å°½é‡é¿å… unwrap, expect
â€¢ ä½¿ç”¨ pub use åœ¨ mod.rs èšåˆæ¨¡å—å¯¹å¤–æ¥å£

â¸»

ğŸ§  AI å·¥å…·å‹å¥½å»ºè®®
â€¢ æ¯ä¸ªæ¨¡å—èŒè´£å•ä¸€ã€æ–‡ä»¶ç‹¬ç«‹ï¼Œåˆ©äº AI è¯­ä¹‰ç´¢å¼•
â€¢ è·¯ç”± â†’ è°ƒç”¨ service â†’ ç»„åˆ repo â†’ è¿”å› model
â€¢ API handler å±‚ä¸å‡ºç°ä¸šåŠ¡é€»è¾‘ï¼ˆä»…æå–å‚æ•° + è°ƒç”¨ï¼‰
â€¢ æ•°æ®ç»“æ„å…·å¤‡ serde tagï¼ˆrename_all = "camelCase"ï¼‰æ–¹ä¾¿ç±»å‹æ¨å¯¼

â¸»

æœ¬è§„èŒƒé€‚ç”¨äº Cursor rules/backend.mdï¼Œå¯æ ¹æ®é¡¹ç›®æ¼”è¿›æ‰©å±•æ¨¡å—ã€‚
